<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.ojs/JQuery-zTree-v3.5.15tml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>地图点管理</title>
    <link rel="stylesheet" type="text/css" href="../../css/default.css">
    <link rel="stylesheet" type="text/css" href="../../js/jquery-easyui-1.3.5/themes/gray/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../js/jquery-easyui-1.3.5/themes/icon.css" />
    <script type="text/javascript" src="../../js/jquery-easyui-1.3.5/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../../js/jquery-easyui-1.3.5/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../js/extends.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>

</head>
<body class="easyui-layout" >
<div id="body" region="center" >
    <!-- 查询条件区域 -->
    <div id="search_area" >
        <div id="conditon">
            <table border="0">
                <tr>
                    <td>点类别：</td>
                    <td ><select id="formPointType" class="easyui-combobox" name="pointType" style="width:200px;">
                        <option value="">全部</option>
                        <option value="0">普通点</option>
                        <option value="1">线路点</option>
                    </select></td>
                    <td>&nbsp;分组类别：</td>
                    <td><input id="formMapGroupId" class="easyui-combobox" name="mapGroupId"
                               >
                    </td>
                    <td>&nbsp;状态：</td>
                    <td><select id="formStatus" class="easyui-combobox" name="status" style="width:200px;">
                        <option value="">全部</option>
                        <option value="0">无效</option>
                        <option value="1">有效</option>
                    </select>
                    </td>
                    <td>
                        <a  href="javascript:void(0)" class="easyui-linkbutton my-search-button" iconCls="icon-search" plain="true" onclick="mapPointList()">查询</a>
                        <a  href="javascript:void(0)" class="easyui-linkbutton my-search-button" iconCls="icon-reset" plain="true" >重置</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <!-- 数据表格区域 -->
    <table id="mapPointList" class="easyui-datagrid" style="width:400px;height:250px"
           data-options="fitColumns:true,singleSelect:true,rownumbers:true,showPageList:false,pagination:true">
        <thead>
        <tr>
            <th data-options="field:'mapPointId',width:30,halign:'center',align:'center'">记录id</th>
            <th data-options="field:'mapPointName',width:15,halign:'center',align:'center'">点名称</th>
            <th data-options="field:'mapPointLongitude',width:20,halign:'center',align:'center'">经度</th>
            <th data-options="field:'mapPointLatitude',width:20,halign:'center',align:'center'">纬度</th>
            <th data-options="field:'mapPointDesc',width:30,halign:'center',align:'center',hidden:true">点描述</th>
            <th data-options="field:'pointType',width:10,halign:'center',align:'center',hidden:true">点类别</th>
            <th data-options="field:'pointTypeDesc',width:10,halign:'center',align:'center'">点类别</th>
            <th data-options="field:'sort',width:15,halign:'center',align:'center'">排序号</th>
            <th data-options="field:'mapGroupId',width:50,halign:'center',align:'center',hidden:true">分组id</th>
            <th data-options="field:'mapGroupName',width:25,halign:'center',align:'center'">分组名称</th>
            <th data-options="field:'status',width:20,halign:'center',align:'center',hidden:true">状态</th>
            <th data-options="field:'statusDesc',width:20,halign:'center',align:'center'">状态</th>
            <th data-options="field:'createTime',width:40,halign:'center',align:'center'">创建时间</th>
            <th data-options="field:'modifiedTime',width:40,halign:'center',align:'center'">修改时间</th>
            <th data-options="field:'opera',width:20,halign:'center',align:'center',formatter:opera">操作</th>
        </tr>
        </thead>
    </table>

    <div id="tt_btn">
        <a href="javascript:void(0)"  id="save" class="easyui-linkbutton" iconCls="icon-add" plain="true">新增</a>
    </div>
    <div id="addOrEditDlg" class="easyui-dialog" title="新增/修改" style="width:400px;height:400px;padding:10px" data-options="closed:true">
        <div class="content">
            <form id="dlgSaveMapPoint" method="post">
                <table width="280" border="0" align="center" cellpadding="3">
                    <tr hidden><!--hidden-->
                        <td width="80" align="right"><span class="x"></span>id：</label></td>
                        <td width="200">
                            <input name="mapPointId" id="dlgMapPointId" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x">*</span>点名称：</label></td>
                        <td width="200">
                            <input name="mapPointName" id="dlgMapPointName" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x"></span>经度：</label></td>
                        <td width="200">
                            <input name="mapPointLongitude" id="dlgMapPointLongitude" /></td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x"></span>纬度：</label></td>
                        <td><input name="mapPointLatitude" id="dglMapPointLatitude" /></td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x"></span>描述：</label></td>
                        <td><input name="mapPointDesc" id="dglMapPointDesc" /></td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x"></span>点类别</label></td>
                        <td><select id="dglPointType" class="easyui-combobox" name="pointType" style="width:100px;">
                                <option value="0">普通点</option>
                                <option value="1">线路点</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x"></span>排序（路线类别填写）：</label></td>
                        <td><input name="sort" id="dglSort" /></td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x"></span>组：</label></td>
                        <td><input id="dlgMapGroupId" class="easyui-combobox" name="mapGroupId"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;状态：</td>
                        <td><select id="status" class="easyui-combobox" name="status" style="width:100px;">
                            <option value="">全部</option>
                            <option value="0">无效</option>
                            <option value="1">有效</option>
                        </select>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <!-- 弹出框按钮 -->
        <div class="windowButton">
            <a id="saveBtn" onclick="save()" class="easyui-linkbutton my-dialog-button" plain="true" icon="icon-save" href="javascript:void(0)" > 新增保存</a>
            <a id="editBtn" onclick="edit()" class="easyui-linkbutton my-dialog-button" plain="true" icon="icon-save" href="javascript:void(0)" > 修改保存</a>
        </div>
    </div>
</div>
<!-- 新增 -->

<script>
    var mapGroupType = [];
    $(function(){
        $("#mapPointList").datagrid({
            height:$("#body").height()-$('#search_area').height()-5,
            width:$("#body").width(),
            idField:'mapPointId',
            url:"/back/map/point/list.do",
            toolbar:'#tt_btn',
            onDblClickRow:function(rowIndex, rowData){
                viewDetail(rowData.mapPointId);
            }
        });

        //新增弹出框
        $("#save").on("click", function(){
            $('#addOrEditDlg').dialog('open');
            $('#dlgSaveMapPoint').form('clear');
            $('#editBtn').hide();
            $('#saveBtn').show();
            $('#dlgMapGroupId').combobox({
                valueField:'mapGroupId',
                textField:'mapGroupName',
                data:mapGroupType
            });
        });
        //修改
        $("#update").on("click", function(){
            $parent.messager.alert("提示","update", "info");
        });

        /**
         *
         * 加载分组数据
         */
        $.ajax({
            url:"/portal/map/group/list.do",
            type:"post",
            success:function (data) {
                mapGroupType = data.data;
                $('#formMapGroupId').combobox({
                    valueField:'mapGroupId',
                    textField:'mapGroupName',
                    data:mapGroupType
                });
            }
        });
    })
    function mapPointList() {
        var mapGroupId = $('#formMapGroupId').combobox('getValue');
        var pointType = $('#formPointType').combobox('getValue');
        var status = $('#formStatus').combobox('getValue');
        $("#mapPointList").datagrid({
            url:'/back/map/point/list.do',
            queryParams:{
                mapGroupId:mapGroupId,
                pointType:pointType,
                status:status
            }
        });
    }
    function opera(value, row, index) {
        return '<a href="#" onclick="editOneRow('+index+')">修改详情</a>';
    }
    function save() {
        $('#dlgSaveMapPoint').form('submit',{
            url:"/back/map/point/addOrUpdate.do",
            dataType:"json",
            success:function (data) {
                var data = eval('(' + data + ')');
                console.log(data);
                if(data.status=="0"){
                    $.messager.alert('Warning',data.msg);
                    $('#addOrEditDlg').dialog('close');
                    mapPointList();
                }else{
                    $.messager.alert('Warning',data.msg);
                }
            }
        });
    }
    function editOneRow(index) {
        var rows = $('#mapPointList').datagrid('getRows');
        var Obj=rows[index];
        $('#addOrEditDlg').dialog('open');
        $('#saveBtn').hide();
        $('#editBtn').show();
        $('#dlgMapGroupId').combobox({
            valueField:'mapGroupId',
            textField:'mapGroupName',
            data:mapGroupType
        });
        loadDataToForm(Obj);
    }
    function loadDataToForm(Obj) {
        $("#dlgSaveMapPoint").form("load",{
            mapPointId:Obj.mapPointId,
            mapPointName:Obj.mapPointName,
            mapPointLongitude:Obj.mapPointLongitude,
            mapPointLatitude:Obj.mapPointLatitude,
            mapPointDesc:Obj.mapPointDesc,
            groupType:Obj.groupType,
            sort:Obj.sort,
            mapGroupId:Obj.mapGroupId,
            mapGroupName:Obj.mapGroupName,
            status:Obj.status
        });
    }
    function edit() {
        $('#dlgSaveMapPoint').form('submit',{
            url:"/back/map/point/addOrUpdate.do",
            dataType:"json",
            success:function (data) {
                var data = eval('(' + data + ')');
                console.log(data);
                if(data.status=="0"){
                    $.messager.alert('提示',data.msg);
                    $('#addOrEditDlg').dialog('close');
                    mapPointList();
                }else{
                    $.messager.alert('提示',data.msg);
                }
            }
        });
    }
    function viewDetail(date, id){
        $parent.messager.alert("提示","查询详细", "info");
    }

    //监听窗口大小变化
    window.onresize = function(){
        setTimeout(domresize,300);
    };
    //改变表格宽高
    function domresize(){
        $('#tt').datagrid('resize',{
            height:$("#body").height()-$('#search_area').height()-5,
            width:$("#body").width()
        });
    }
</script>
</body>
</html>
