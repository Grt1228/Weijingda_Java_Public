<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.ojs/JQuery-zTree-v3.5.15tml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>用户管理</title>
    <link rel="stylesheet" type="text/css" href="../../css/default.css">
    <link rel="stylesheet" type="text/css" href="../../js/jquery-easyui-1.3.5/themes/gray/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../js/jquery-easyui-1.3.5/themes/icon.css" />
    <script type="text/javascript" src="../../js/jquery-easyui-1.3.5/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../../js/jquery-easyui-1.3.5/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../js/extends.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>

</head>
<body class="easyui-layout" >
<div id="body" region="center" >
    <!-- 查询条件区域 -->
    <div id="search_area" >
        <div id="conditon">
            <table border="0">
                <tr>
                    <td >学号：</td>
                    <td width="200">
                        <input name="loginName" id="loginName" /></td>
                    <td >姓名：</td>
                    <td width="200">
                        <input name="studentName" id="studentName" /></td>
                    <td>
                        <a  href="javascript:void(0)" class="easyui-linkbutton my-search-button" iconCls="icon-search" plain="true" onclick="userInfoList()">查询</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <!-- 数据表格区域 -->
    <table id="userList" class="easyui-datagrid" style="width:400px;height:250px"
           data-options="fitColumns:true,singleSelect:true,rownumbers:true,showPageList:false,pagination:true">
        <thead>
        <tr>
            <th data-options="field:'studentId',width:100,halign:'center',align:'center'">记录id</th>
            <th data-options="field:'loginName',width:200,halign:'center',align:'center'">学号</th>
            <th data-options="field:'studentName',width:80,halign:'center',align:'center'">姓名</th>
            <th data-options="field:'gender',width:80,halign:'center',align:'center',hidden:true">性别</th>
            <th data-options="field:'orgCode',width:80,halign:'center',align:'center',hidden:true">用户类别</th>
            <th data-options="field:'orgCodeDesc',width:80,halign:'center',align:'center'">用户类别</th>
            <th data-options="field:'universityName',width:80,halign:'center',align:'center',hidden:true">大学名称</th>
            <th data-options="field:'collegeName',width:80,halign:'center',align:'center',hidden:true">学院名称</th>
            <th data-options="field:'majorsName',width:80,halign:'center',align:'center',hidden:true">专业名称</th>
            <th data-options="field:'collegeId',width:80,halign:'center',align:'center',hidden:true">学院编号</th>
            <th data-options="field:'majorsId',width:80,halign:'center',align:'center',hidden:true">专业编号</th>
            <th data-options="field:'className',width:80,halign:'center',align:'center'">班级名称</th>
            <th data-options="field:'classId',width:80,halign:'center',align:'center',hidden:true">班级编号</th>
            <th data-options="field:'mobile',width:80,halign:'center',align:'center'">电话</th>
            <th data-options="field:'email',width:80,halign:'center',align:'center'">邮箱</th>
            <th data-options="field:'status',width:80,halign:'center',align:'center',hidden:true">状态</th>
            <th data-options="field:'statusDesc',width:80,halign:'center',align:'center'">状态</th>
            <th data-options="field:'role',width:80,halign:'center',align:'center'">权限</th>
            <th data-options="field:'roleDesc',width:80,halign:'center',align:'center'">权限desc</th>
            <th data-options="field:'createTime',width:80,halign:'center',align:'center'">创建时间</th>
            <th data-options="field:'modifiedTime',width:80,halign:'center',align:'center'">修改时间</th>
            <!--<th data-options="field:'opera',width:50,halign:'center',align:'center',formatter:opera">修改</th>-->
        </tr>
        </thead>
    </table>

    <div id="addOrEditDlg" class="easyui-dialog" title="修改" style="width:400px;height:220px;padding:10px" data-options="closed:true">
        <div class="content">
            <form id="addOrEditForm" method="post">
                <table width="280" border="0" align="center" cellpadding="3">
                    <tr hidden>
                        <td width="80" align="right"><span class="x"></span>id：</label></td>
                        <td width="200">
                            <input name="lostGoodId" id="dlgLostGoodId" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x">*</span>匿名称：</label></td>
                        <td width="200">
                            <input name="adderName" id="dlgAdderName" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x">*</span>联系方式：</label></td>
                        <td width="200">
                            <input name="adderMobile" id="dlgAdderMobile" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x">*</span>标题：</label></td>
                        <td width="200">
                            <input name="goodTitle" id="dlgGoodTitle" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x">*</span>描述：</label></td>
                        <td width="200">
                            <input name="goodDetail" id="dlgGoodDetail" /></td>
                    </tr>
                    <tr>
                        <td width="80" align="right"><span class="x">*</span>地点：</label></td>
                        <td width="200">
                            <input name="goodPosition" id="dlgGoodPosition" /></td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x">*</span>类别：</label></td>
                        <td>
                            <select id="dlgGoodType" class="easyui-combobox" name="goodType" style="width: 80px">
                                <option value="1">发布捡到物品</option>
                                <option value="2">发布寻找物品</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x">*</span>类别：</label></td>
                        <td>
                            <select id="dlgGoodStatus" class="easyui-combobox" name="goodStatus" style="width: 80px">
                                <option value="01">完成</option>
                                <option value="02">未完成</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td align="right"><span class="x">*</span>状态：</label></td>
                        <td><select id="dlgStatus" class="easyui-combobox" name="status" style="width: 80px">
                            <option value="0">无效</option>
                            <option value="1">有效</option>
                        </select>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <!-- 弹出框按钮 -->
        <div class="windowButton">
            <a id="editBtn" onclick="saveEdit()" class="easyui-linkbutton my-dialog-button" plain="true" icon="icon-save" href="javascript:void(0)" > 修改保存</a>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        $("#userList").datagrid({
            height:$("#body").height()-$('#search_area').height()-5,
            width:$("#body").width(),
            url:"/back/user/list.do",
            onLoadSuccess:function (data) {
                //goLogin(data);
                if(data.status=="10"){
                    $.messager.alert('提示','登陆过期，重新登陆!','warning',function(r){
                        if (true){
                            window.location.href="/login.html";
                        }
                    });
                }
            }
        });
    })

    function opera(value, row, index) {
        return '<a href="#" onclick="edit('+index+')">修改</a>';
    }

    function edit(index) {
        var rows = $('#userList').datagrid('getRows');
        var Obj=rows[index];
        $('#addOrEditDlg').dialog('open');
        $('#addOrEditForm').form('clear');
        $('#editBtn').show();
        loadDataToForm(Obj);
    }
    function loadDataToForm(Obj) {
        $("#addOrEditForm").form("load",{

        });
    }

    function saveEdit() {
        $('#addOrEditForm').form('submit',{
            url:"/back/user/save.do",
            dataType:"json",
            success:function (data) {
                var data = eval('(' + data + ')');
                console.log(data);
                if(data.status=="0"){
                    $.messager.alert('提示',data.msg);
                    $('#addOrEditDlg').dialog('close');
                    userInfoList();
                }else{
                    $.messager.alert('提示',data.msg);
                }
            }
        });
    }
    function userInfoList() {
        var loginName = $('#loginName').val();
        var studentName = $('#studentName').val();
        $("#userList").datagrid({
            url:'/back/user/list.do',
            queryParams:{
                loginName:loginName,
                studentName:studentName
            }
        });
    }
</script>
</body>
</html>r